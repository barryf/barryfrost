{%- import '../macros/photo.njk' as photo %}
{%- macro context(context, contextLabel, helpers) %}

<div class="mb-4">
  {%- if context.properties %}
    {%- set author = context.properties.author %}
    <h2 class="text-gray-600">
      {{ contextLabel }}
      {%- if author and author[0].properties and author[0].properties.name %}
        <a href="{{ author[0].properties.url[0] }}" class="font-bold text-yellow-600 hover:text-black" rel="noopener">
          {%- if author[0].properties.photo %}
            <img src="{{ author[0].properties.photo[0].value if author[0].properties.photo[0].value else author[0].properties.photo[0] }}" class="w-6 h-6 inline-block mx-1 rounded-full">
          {%- endif %}
          {{ author[0].properties.name[0] }}</a>&rsquo;s
      {%- else %}
        a
      {%- endif %}
      post on
      <a href="{{ context.properties.url[0] }}" class="font-bold text-yellow-600 hover:text-black" rel="noopener">
        <span class="w-3 h-3 inline-block">
          {{ helpers.iconFromUrl(context.properties.url[0]) | safe }}
        </span>
      </a>
    </h2>
    <div class="mb-8 mt-1 prose">
      <blockquote>
        {%- if context.properties.name %}
        <div class="font-bold">{{ context.properties.name[0] | trim }}</div>
        {%- endif %}
        {{ helpers.contextContent(context) | safe }}
      </blockquote>
    </div>
    {%- if context.properties.photo %}
      <div class="mb-4">
        <ul>
          {%- for p in context.properties.photo %}
            {#- don't show photo if it's the author photo #}
            {%- if author and author[0].photo and ((author[0].photo[0].value and author[0].photo[0].value != p) or (author[0].photo[0] != p)) %}
              <li class="max-h-40">
                {{ photo.photo(p) | safe }}
              </li>
            {%- endif %}
          {%- endfor %}
        </ul>
      </div>
    {%- endif %}
  {%- else %}
    <h2>{{ contextLabel }}</h2>
    <a href={{ context }} class="font-bold text-yellow-600 hover:text-black" rel="noopener">
        {{ context }}
    </a>
  {%- endif %}
</div>

{%- endmacro %}
